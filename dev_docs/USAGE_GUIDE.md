# IPAMS 凭证和主机信息管理使用指南

## 一、凭证管理

### 1.1 创建凭证

1. 进入"凭证管理"页面
2. 点击"添加凭证"按钮
3. 填写凭证信息：
   - **凭证名称**: 如 "Production Linux Servers"
   - **凭证类型**: Linux / Windows / VMware
   - **用户名**: root / administrator / vcenter_admin
   - **密码**: ******（自动加密存储）
   - **SSH私钥**: （Linux可选）
   - **默认凭证**: 是否设为默认

### 1.2 查看凭证详情

- 点击"查看详情"按钮
- 显示解密后的用户名、密码
- 支持一键复制到剪贴板
- 密码默认隐藏，可切换显示

### 1.3 查看绑定主机

- 点击"查看绑定"按钮
- 查看该凭证绑定的所有主机列表
- 支持跳转到主机详情页

### 1.4 测试连接

- 点击"测试连接"按钮
- 输入要测试的主机IP地址
- 系统立即验证连接是否成功
- 支持SSH、WinRM、VMware连接测试

### 1.5 批量绑定主机

1. 点击"批量绑定"按钮
2. 在主机选择对话框中选择多个主机
3. 确认绑定
4. 系统显示绑定结果统计

### 1.6 批量解绑主机

1. 点击"查看绑定"查看绑定的主机
2. 在列表中勾选要解绑的主机
3. 点击"批量解绑"
4. 确认操作

## 二、主机信息管理

### 2.1 查看主机列表

- 进入"主机信息"页面
- 自动显示所有已认领的IP
- 支持筛选、搜索、排序

### 2.2 绑定凭证

**单个绑定**:
1. 点击主机的"绑定凭证"按钮
2. 选择凭证
3. 确认绑定

**批量绑定**:
1. 勾选多个主机
2. 点击"批量绑定凭证"按钮
3. 选择凭证
4. 确认操作

### 2.3 解绑凭证

**单个解绑**:
1. 在主机详情中查看绑定列表
2. 点击"解绑"按钮

**批量解绑**:
1. 勾选多个主机
2. 点击"批量解绑凭证"按钮
3. 选择凭证
4. 确认操作

### 2.4 采集主机信息

**单个采集**:
1. 点击主机的"采集"按钮
2. 选择凭证（如果主机未绑定凭证）
3. 或直接采集（使用绑定凭证）

**自定义凭证采集**:
1. 点击"采集"按钮
2. 选择"使用自定义凭证"
3. 填写：
   - 用户名
   - 密码
   - 私钥（可选）
   - 端口号（可选，默认22/5985）
4. 确认采集

**批量采集**:
1. 勾选多个主机
2. 点击"批量采集"按钮
3. 系统并发执行采集任务
4. 查看采集状态和结果

### 2.5 查看采集结果

- 点击"查看详情"按钮
- 查看完整的硬件、软件、网络信息
- 包括：操作系统、CPU、内存、磁盘、网络等

### 2.6 导出数据

1. 勾选要导出的主机
2. 点击"批量导出"按钮
3. 选择导出方式：
   - **使用模板**: 基础信息、详细信息、完整信息
   - **自定义字段**: 选择需要的字段
4. 下载Excel文件

## 三、VMware主机管理

### 3.1 识别VMware主机

用户需要在采集前手动标记主机类型：
- **physical**: 物理主机
- **vmware**: vCenter/ESXi
- **other_virtualization**: 其他虚拟化

### 3.2 vCenter采集

1. 创建VMware类型凭证
2. 标记主机类型为"vmware"
3. 绑定凭证
4. 执行采集
5. 系统自动：
   - 连接到vCenter
   - 采集所有虚拟机信息
   - 创建父子关系
   - 存储VM详细信息

### 3.3 树形展示

- vCenter主机显示为父节点
- 虚拟机会自动归类到对应的vCenter下
- 支持展开/折叠查看
- 保持层级关系清晰

### 3.4 VMware导出

- 支持导出vCenter + 所有VM
- 支持仅导出vCenter主机
- 支持仅导出子VM列表
- 保持树形结构

## 四、最佳实践

### 4.1 凭证管理

1. **命名规范**: 使用清晰、有意义的名称
   - "Production Linux Servers"
   - "Development Windows VMs"
   - "VMware vCenter-BJ"

2. **凭证分组**: 按环境、用途分组
   - 生产环境凭证
   - 测试环境凭证
   - 临时凭证

3. **定期更新**: 密码轮换后及时更新凭证

4. **权限最小化**: 使用最小权限账号

### 4.2 主机管理

1. **先认领后采集**: 确保只采集授权的主机

2. **批量操作**: 使用批量绑定/采集提高效率

3. **定期采集**: 设置定期采集任务获取最新信息

4. **异常监控**: 关注采集失败的主机，及时处理

### 4.3 VMware管理

1. **中心化管理**: 为每个vCenter创建凭证

2. **完整扫描**: 定期扫描所有虚拟机

3. **层级管理**: 利用树形结构清晰管理

4. **资源分析**: 导出数据进行资源统计分析

## 五、常见问题

### Q1: 忘记凭证密码怎么办？
**A**: 点击"查看详情"按钮，可以查看解密后的密码并一键复制。

### Q2: 如何快速更换所有主机的凭证？
**A**: 
1. 创建新凭证
2. 在凭证管理页面，先批量绑定新凭证
3. 再批量解绑旧凭证

### Q3: 采集失败怎么排查？
**A**: 
1. 检查凭证是否正确
2. 使用"测试连接"功能验证
3. 查看采集错误信息
4. 检查网络连通性和防火墙

### Q4: VMware虚拟机能单独管理吗？
**A**: 可以。虚拟机自动关联到vCenter，同时支持单独查看和管理。

### Q5: 批量操作支持多少主机？
**A**: 默认支持所有分页数据。大列表建议分批操作或增加筛选条件。

## 六、API使用示例

### 批量绑定凭证到主机

```bash
curl -X POST http://localhost:5000/api/v1/host/batch-bind \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "host_ids": ["host1", "host2", "host3"],
    "credential_id": "credential_id_123"
  }'
```

### 使用自定义凭证采集

```bash
curl -X POST http://localhost:5000/api/v1/host/host123/collect \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "root",
    "password": "password123",
    "credential_type": "linux",
    "port": 2222
  }'
```

### 批量绑定主机到凭证

```bash
curl -X POST http://localhost:5000/api/v1/credential/cred123/batch-bind \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "host_ids": ["host1", "host2", "host3"]
  }'
```

## 七、快捷操作

| 功能 | 快捷方式 | 说明 |
|------|----------|------|
| 刷新列表 | F5 或 刷新按钮 | 重新加载数据 |
| 批量选择 | Ctrl+A | 全选当前页 |
| 取消选择 | Ctrl+D | 取消全选 |
| 搜索 | Ctrl+F | 快速搜索 |

## 八、性能优化建议

1. **分页加载**: 使用合理的分页大小（建议10-50条/页）
2. **筛选优先**: 先筛选再批量操作
3. **分批处理**: 大量主机分批处理
4. **定期清理**: 清理无用的HostInfo记录

## 九、安全注意事项

1. **凭证加密**: 所有密码自动AES加密存储
2. **权限控制**: 每个用户只能管理自己的凭证
3. **连接测试**: 测试连接不保存日志
4. **定期审查**: 定期审查凭证使用情况

## 十、技术支持

- 详细文档: `QUICK_START.md`
- 功能总结: `PROGRESS_SUMMARY.md`
- API文档: 待补充Swagger文档
- 问题反馈: GitHub Issues

